<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intents — FlowEngine</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><path fill='%233B82F6' d='M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z'/></svg>">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #0f172a;
      --primary-light: #1e293b;
      --secondary: #3b82f6;
      --secondary-dark: #2563eb;
      --accent: #8b5cf6;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --bg: #f8fafc;
      --bg-secondary: #ffffff;
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --text-tertiary: #94a3b8;
      --radius: 10px;
      --radius-lg: 14px;
      --shadow-xs: 0 1px 2px rgba(15, 23, 42, 0.04);
      --shadow-sm: 0 2px 8px rgba(15, 23, 42, 0.06);
      --shadow-md: 0 4px 16px rgba(15, 23, 42, 0.08);
      --shadow-lg: 0 8px 24px rgba(15, 23, 42, 0.12);
    }

    body {
      font-family:
        "Inter",
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .sidebar {
      width: 260px;
      height: 100vh;
      background: var(--primary);
      padding: 32px 24px;
      position: fixed;
      left: 0;
      top: 0;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 1.5rem;
      color: white;
      font-weight: 700;
      margin-bottom: 40px;
      letter-spacing: -0.02em;
    }

    .logo i {
      font-size: 1.6rem;
      color: var(--secondary);
      background: rgba(59, 130, 246, 0.15);
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
    }

    .nav-menu {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      text-decoration: none;
      color: rgba(255, 255, 255, 0.7);
      border-radius: var(--radius);
      font-size: 0.94rem;
      font-weight: 500;
      transition: all 0.2s ease;
      position: relative;
    }

    .nav-link i {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      transform: translateX(2px);
    }

    .nav-link.active {
      background: linear-gradient(135deg,
          var(--secondary) 0%,
          var(--secondary-dark) 100%);
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .main-content {
      margin-left: 260px;
      min-height: 100vh;
    }

    .topbar {
      background: var(--bg-secondary);
      padding: 24px 40px;
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow-xs);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .topbar-title {
      font-size: 1.75rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 14px;
      letter-spacing: -0.02em;
    }

    .topbar-title i {
      font-size: 1.5rem;
      color: var(--secondary);
      background: rgba(59, 130, 246, 0.1);
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
    }

    .add-btn {
      padding: 11px 20px;
      background: linear-gradient(135deg,
          var(--secondary) 0%,
          var(--secondary-dark) 100%);
      color: white;
      border-radius: var(--radius);
      font-size: 0.94rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
      transition: all 0.2s ease;
    }

    .add-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.35);
    }

    .add-btn:active {
      transform: translateY(0);
    }

    .content-area {
      padding: 36px 40px;
      max-width: 1600px;
    }

    .filter-section {
      background: white;
      padding: 24px 32px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
      display: flex;
      gap: 20px;
      align-items: end;
    }

    .filter-group {
      flex: 1;
      position: relative;
    }

    .filter-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
    }

    .filter-input {
      width: 100%;
      padding: 11px 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.94rem;
      font-family: inherit;
      color: var(--text-primary);
      transition: all 0.2s ease;
      background: var(--bg-secondary);
    }

    .filter-input:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: white;
    }

    .search-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      max-height: 250px;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      margin-top: 4px;
      display: none;
    }

    .search-dropdown.show {
      display: block;
    }

    .search-option {
      padding: 12px 14px;
      cursor: pointer;
      border-bottom: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .search-option:hover {
      background: var(--bg);
    }

    .search-option-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .search-option-code {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .card {
      background: white;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .card-header {
      padding: 24px 32px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to bottom, #fafbfc 0%, #ffffff 100%);
    }

    .card-title {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }

    .stats-badge {
      background: var(--bg);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    thead {
      border-bottom: 2px solid var(--border);
    }

    tbody tr {
      border-bottom: 1px solid var(--border-light);
    }

    th {
      background: #fafbfc;
      padding: 18px 16px;
      text-align: center;
      font-weight: 700;
      color: var(--text-secondary);
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: none;
    }

    th:nth-child(1) {
      width: 18%;
    }

    th:nth-child(2) {
      width: 18%;
    }

    th:nth-child(3) {
      width: 22%;
    }

    th:nth-child(4) {
      width: 15%;
    }

    th:nth-child(5) {
      width: 27%;
    }

    td {
      padding: 28px 16px;
      border-bottom: none;
      font-size: 0.94rem;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      vertical-align: middle;
    }

    tr.data-row {
      transition: all 0.15s ease;
      cursor: pointer;
    }

    tr.data-row:hover {
      background: #f8fafc;
      box-shadow: inset 3px 0 0 var(--secondary);
    }

    .intent-name {
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }

    .display-name {
      color: var(--text-secondary);
      font-size: 0.88rem;
      text-align: center;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status-active {
      background: rgba(16, 163, 117, 0.1);
      color: var(--success);
    }

    .status-inactive {
      background: rgba(148, 163, 184, 0.15);
      color: var(--text-secondary);
    }

    .actions {
      display: inline-flex;
      gap: 4px;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      margin: 6px 0;
    }

    .action-btn {
      padding: 6px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: white;
      color: var(--text-secondary);
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
      line-height: 1;
    }

    .action-btn i {
      font-size: 0.8rem;
      margin-right: 4px;
    }

    .action-btn:hover {
      background: var(--secondary);
      color: white;
      border-color: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.25);
    }

    .action-btn.delete:hover {
      background: var(--danger);
      border-color: var(--danger);
      box-shadow: 0 4px 8px rgba(239, 68, 68, 0.25);
    }

    .expanded-row {
      display: none;
    }

    .expanded-row.show {
      display: table-row;
    }

    .expanded-content {
      padding: 24px 32px;
      background: linear-gradient(to bottom, #f8fafc 0%, #ffffff 100%);
      border-top: 2px solid var(--border);
    }

    .expanded-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .expanded-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .expanded-field-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .expanded-field-value {
      font-size: 0.94rem;
      color: var(--text-primary);
      font-weight: 500;
      padding: 10px 12px;
      background: white;
      border-radius: var(--radius);
      border: 1px solid var(--border-light);
    }

    .expanded-field-value.null-value {
      color: var(--text-tertiary);
      font-style: italic;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 0;
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 600px;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s ease;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 2px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to bottom, #fafbfc 0%, #ffffff 100%);
      flex-shrink: 0;
    }

    .modal-header h3 {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .modal-header h3 i {
      width: 40px;
      height: 40px;
      background: rgba(59, 130, 246, 0.1);
      color: var(--secondary);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .close-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: white;
      color: var(--text-secondary);
      font-size: 1.3rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.9rem;
      font-family: inherit;
      color: var(--text-primary);
      transition: all 0.2s ease;
      background: var(--bg-secondary);
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: white;
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-select {
      cursor: pointer;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--bg);
      border-radius: var(--radius);
      border: 1px solid var(--border-light);
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--secondary);
    }

    .checkbox-group label {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      cursor: pointer;
      user-select: none;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 8px 0;
    }

    .toggle {
      width: 52px;
      height: 28px;
      background: #cbd5e1;
      border-radius: 14px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }

    .toggle.active {
      background: var(--success);
    }

    .toggle::after {
      content: "";
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle.active::after {
      transform: translateX(24px);
    }

    .toggle-label {
      font-weight: 600;
      color: var(--text-primary);
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 2px solid var(--border-light);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      background: var(--bg);
      flex-shrink: 0;
    }

    .btn {
      padding: 10px 18px;
      border-radius: var(--radius);
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      justify-content: center;
    }

    .btn-primary {
      background: linear-gradient(135deg,
          var(--secondary) 0%,
          var(--secondary-dark) 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.35);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);
    }

    .delete-modal-content {
      text-align: center;
      max-width: 480px;
    }

    .modal-icon {
      width: 64px;
      height: 64px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .modal-icon i {
      font-size: 1.8rem;
      color: var(--danger);
    }

    .modal-title {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text-primary);
      letter-spacing: -0.01em;
      text-align: center;
    }

    .modal-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 24px;
      line-height: 1.6;
      text-align: center;
    }

    .detail-field {
      padding: 10px 12px;
      font-weight: 600;
      background: var(--bg);
      border-radius: var(--radius);
    }

    .child-links {
      padding-top: 16px;
      border-top: 1px solid var(--border);
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .child-link-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--secondary);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95rem;
      padding: 8px 0;
    }

    .child-link-btn:hover {
      color: var(--secondary-dark);
      gap: 10px;
    }

    .child-link-btn i {
      font-size: 1rem;
    }

    .empty-state {
      padding: 80px 20px;
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-icon {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg,
          rgba(59, 130, 246, 0.08) 0%,
          rgba(139, 92, 246, 0.08) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .empty-icon i {
      font-size: 3.5rem;
      color: var(--secondary);
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .empty-state p {
      font-size: 0.95rem;
      color: var(--text-tertiary);
    }

    .loading {
      padding: 60px;
      text-align: center;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 2rem;
      margin-bottom: 16px;
      color: var(--secondary);
    }

    .loading-text {
      font-size: 0.95rem;
      font-weight: 500;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      padding: 12px 16px;
      border-radius: var(--radius);
      margin-bottom: 16px;
      display: none;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .confirm-modal-content {
      max-width: 480px;
    }

    .confirm-icon {
      width: 64px;
      height: 64px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .confirm-icon i {
      font-size: 1.8rem;
      color: var(--warning);
    }

    .notification-popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.5);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3000;
      animation: fadeIn 0.2s ease;
    }

    .notification-popup.active {
      display: flex;
    }

    .notification-content {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.3);
      max-width: 500px;
      width: 90%;
      padding: 0;
      animation: slideUpBounce 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      gap: 20px;
      position: relative;
      overflow: hidden;
    }

    @keyframes slideUpBounce {
      0% {
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }

      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .notification-icon {
      background: linear-gradient(135deg,
          var(--secondary) 0%,
          var(--secondary-dark) 100%);
      padding: 32px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .notification-icon i {
      font-size: 2.5rem;
      color: white;
    }

    .notification-body {
      padding: 28px 20px 28px 0;
      flex: 1;
    }

    .notification-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
      letter-spacing: -0.01em;
    }

    .notification-message {
      font-size: 0.95rem;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 0;
    }

    .notification-link-container {
      margin-top: 18px;
      padding-top: 18px;
      border-top: 1px solid var(--border-light);
    }

    .notification-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: linear-gradient(135deg,
          var(--secondary) 0%,
          var(--secondary-dark) 100%);
      color: white;
      text-decoration: none;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
    }

    .notification-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.35);
      gap: 12px;
    }

    .notification-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(15, 23, 42, 0.05);
      color: var(--text-secondary);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .notification-close:hover {
      background: var(--danger);
      color: white;
      transform: rotate(90deg);
    }

    #cancel:hover {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    /* Ultra-compact row hint (reusable) */
    .table-note {
      margin: 6px 24px;
      /* minimal vertical space */
      padding: 4px 8px;

      font-size: 0.78rem;
      font-weight: 500;
      color: var(--text-tertiary);

      background: transparent;
      border-left: 2px solid var(--secondary);
    }
  </style>
  <link rel="stylesheet" href="responsive.css" />
</head>

<body>
  <aside class="sidebar">
    <div class="logo">
      <i class="fas fa-shield-alt"></i><span>FlowEngine</span>
    </div>
    <nav class="nav-menu">
      <a href="index.html" class="nav-link"><i class="fas fa-home"></i>Dashboard</a>
      <a href="datasources.html" class="nav-link"><i class="fas fa-database"></i>Datasources</a>
      <a href="datasource-configs.html" class="nav-link"><i class="fas fa-cog"></i>Datasource Configs</a>
      <a href="intents.html" class="nav-link active"><i class="fas fa-bullseye"></i>Intents</a>
      <a href="intent-policies.html" class="nav-link"><i class="fas fa-sliders-h"></i>Intent Policies</a>
      <a href="rules.html" class="nav-link"><i class="fas fa-check-double"></i>Validation Rules</a>
    </nav>
  </aside>
  <main class="main-content">
    <div class="topbar">
      <h1 class="topbar-title"><i class="fas fa-bullseye"></i>Intents</h1>
      <button class="add-btn" onclick="openAddModal()">
        <i class="fas fa-plus-circle"></i>Add Intent
      </button>
    </div>
    <div class="content-area">
      <div class="filter-section">
        <div class="filter-group">
          <label class="filter-label">Search Intent</label>
          <input type="text" class="filter-input" id="intentSearch"
            placeholder="Type to search intents or type 'all' for all intents..." autocomplete="off" />
          <div id="searchDropdown" class="search-dropdown"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Intent Configuration</div>
          <div class="stats-badge" id="statsBadge">0 intents</div>
        </div>
        <div class="table-note">
          Click a row to view full intent details
        </div>

        <div id="loadingState" class="loading" style="display: none">
          <i class="fas fa-spinner fa-spin"></i>
          <div class="loading-text">Loading intents...</div>
        </div>
        <table id="intentTable">
          <thead>
            <tr>
              <th>Intent Code</th>
              <th>Display Name</th>
              <th>Description</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="intentRows"></tbody>
        </table>
        <div id="emptyState" class="empty-state" style="display: none">
          <div class="empty-icon"><i class="fas fa-bullseye"></i></div>
          <h3>No Intents Found</h3>
          <p>Get started by creating your first intent configuration.</p>
        </div>
      </div>
    </div>
  </main>
  <div class="modal" id="intentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">
          <i class="fas fa-bullseye"></i><span id="modalTitleText">Add Intent</span>
        </h3>
        <button class="close-btn" onclick="closeIntentModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="error-message" id="errorMessage"></div>
        <input type="hidden" id="intentId" />
        <div class="form-group">
          <label class="form-label">Intent Code</label><input class="form-input" id="intent_code"
            placeholder="e.g., payment_request" />
        </div>
        <div class="form-group">
          <label class="form-label">Display Name</label><input class="form-input" id="display_name"
            placeholder="e.g., Payment Request" />
        </div>
        <div class="form-group">
          <label class="form-label">Description (Optional)</label><textarea class="form-textarea" id="description"
            placeholder="Describe the purpose of this intent..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Category (Optional)</label><input class="form-input" id="category"
            placeholder="e.g., Financial, Support, Operations" />
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <div class="toggle-container">
            <div id="intentIsActive" class="toggle active" onclick="toggleIntentActive()"></div>
            <span class="toggle-label" id="intentActiveLabel">Active</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeIntentModal()" id="cancel">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn btn-primary" onclick="saveIntent()">
          <i class="fas fa-check"></i> Save Intent
        </button>
      </div>
    </div>
  </div>
  <div class="modal" id="detailsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-bullseye"></i><span>Intent Details</span></h3>
        <button class="close-btn" onclick="closeDetailsModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Intent Code</label>
          <div id="detailIntentCode" class="detail-field"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Display Name</label>
          <div id="detailDisplayName" class="detail-field"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <div id="detailStatus" class="detail-field"></div>
        </div>
        <div class="form-group" id="detailDescContainer" style="display: none">
          <label class="form-label">Description</label>
          <div id="detailDescription" class="detail-field"></div>
        </div>
        <div class="form-group" id="detailCategoryContainer" style="display: none">
          <label class="form-label">Category</label>
          <div id="detailCategory" class="detail-field"></div>
        </div>
        <div class="child-links">
          <a href="javascript:void(0);" class="child-link-btn" id="addPolicyBtn" onclick="handlePolicyAction()"><i
              class="fas fa-sliders-h"></i><span id="policyBtnText">Add Intent Policy</span></a>
          <a href="javascript:void(0);" class="child-link-btn" onclick="openAddRuleModal()"><i
              class="fas fa-check-double"></i>Add Validation Rule</a>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDetailsModal()" id="cancel">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </div>
  </div>
  <div class="modal" id="policyModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>
          <i class="fas fa-sliders-h"></i><span id="policyModalTitle">Add Policy</span>
        </h3>
        <button class="close-btn" onclick="closePolicyModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Intent</label><input class="form-input" id="policyIntentName" disabled
            style="background: var(--bg); cursor: not-allowed" />
        </div>
        <div class="form-group">
          <label class="form-label">Language Code</label><select class="form-select" id="language_code">
            <option value="multi">Multi (Default)</option>
            <option value="en">English</option>
            <option value="hi">Hindi</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">N8N Orchestration URL (Optional)</label><input class="form-input" type="url"
            id="n8n_orchestration_url" placeholder="https://n8n.example.com/webhook/..." />
        </div>
        <div class="form-group">
          <label class="form-label">Auto Process Min Confidence (%)</label><input class="form-input" type="number"
            id="auto_process_min_conf" min="0" max="100" step="0.01" placeholder="90.00" />
        </div>
        <div class="form-group">
          <label class="form-label">Manual Review Min Confidence (%)</label><input class="form-input" type="number"
            id="manual_review_min_conf" min="0" max="100" step="0.01" placeholder="80.00" />
        </div>
        <div class="form-group">
          <label class="form-label">Reroute Email (Optional)</label><input class="form-input" type="email"
            id="reroute_email" placeholder="example@domain.com" />
        </div>
        <div class="form-group">
          <label class="form-label">Multi-Intent Mode</label><select class="form-select" id="multi_intent_mode">
            <option value="STRICT_SINGLE">Strict Single</option>
            <option value="AUTO_ALL">Auto All</option>
            <option value="AUTO_SUBSET">Auto Subset</option>
          </select>
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="allow_multi_auto" /><label for="allow_multi_auto">Allow Multi Auto</label>
          </div>
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="allow_subset_auto" /><label for="allow_subset_auto">Allow Subset Auto</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePolicyModal()" id="cancel">
          <i class="fas fa-times"></i>Cancel</button><button class="btn btn-primary" onclick="savePolicy()">
          <i class="fas fa-check"></i><span id="savePolicyBtnText">Save Policy</span>
        </button>
      </div>
    </div>
  </div>
  <div class="modal" id="ruleModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>
          <i class="fas fa-check-double"></i><span id="ruleModalTitle">Add Validation Rule</span>
        </h3>
        <button class="close-btn" onclick="closeRuleModal()">×</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editRuleId" />
        <div class="form-group">
          <label class="form-label">Intent</label><input class="form-input" id="ruleIntentName" disabled
            style="background: var(--bg); cursor: not-allowed" />
        </div>
        <div class="form-group">
          <label class="form-label">Rule Code *</label><input type="text" class="form-input" id="ruleCode"
            placeholder="e.g., SENDER_EMAIL_MATCH" />
        </div>
        <div class="form-group">
          <label class="form-label">Rule Name *</label><input type="text" class="form-input" id="ruleName"
            placeholder="Human-readable rule name" />
        </div>
        <div class="form-group">
          <label class="form-label">Rule Description *</label><textarea class="form-textarea" id="ruleDescription"
            placeholder="Natural language description for LLM..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Datasource *</label><select class="form-select" id="ruleDatasource">
            <option value="">Select a datasource</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Language</label><select class="form-select" id="ruleLanguage">
            <option value="multi">Multi-language</option>
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Execution Order</label><input type="number" class="form-input" id="ruleOrder"
            min="1" value="1" />
        </div>
        <div class="form-group">
          <label class="form-label">Severity</label><select class="form-select" id="ruleSeverity">
            <option value="CRITICAL">Critical</option>
            <option value="WARNING">Warning</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRuleModal()" id="cancel">
          <i class="fas fa-times"></i>Cancel</button><button class="btn btn-primary" onclick="saveRule()">
          <i class="fas fa-check"></i><span id="saveRuleBtnText">Save Rule</span>
        </button>
      </div>
    </div>
  </div>
  <div class="modal" id="duplicateRuleModal">
    <div class="modal-content confirm-modal-content">
      <div class="modal-body" style="padding: 32px 24px; text-align: center">
        <div class="confirm-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="modal-title">Rule Already Exists</h3>
        <p class="modal-text">
          A validation rule with the
          <strong id="duplicateRuleName"></strong> already exists in
          <strong id="duplicateIntentName"></strong>. Do you want to edit the
          existing rule instead?
        </p>
      </div>
      <div class="modal-footer" style="border-top: none; justify-content: center">
        <button class="btn btn-secondary" onclick="closeDuplicateRuleModal()" id="cancel">
          Cancel</button><button class="btn btn-primary" onclick="editDuplicateRule()">
          <i class="fas fa-pen"></i> Yes, Edit Rule
        </button>
      </div>
    </div>
  </div>
  <div class="modal" id="deleteModal">
    <div class="modal-content delete-modal-content">
      <div class="modal-body" style="padding: 32px 24px; text-align: center">
        <div class="modal-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="modal-title">Delete Intent</h3>
        <p class="modal-text">
          Are you sure you want to delete this intent? This will also delete
          all associated policies and validation rules. This action cannot be
          undone.
        </p>
        <input type="hidden" id="deleteIntentId" />
      </div>
      <div class="modal-footer" style="border-top: none; justify-content: center">
        <button class="btn btn-secondary" onclick="closeDeleteModal()" id="cancel">
          Cancel</button><button class="btn btn-danger" onclick="confirmDelete()">
          <i class="fas fa-trash"></i> Delete Intent
        </button>
      </div>
    </div>
  </div>
  <div class="notification-popup" id="notificationPopup">
    <div class="notification-content">
      <div class="notification-icon"><i class="fas fa-info-circle"></i></div>
      <div class="notification-body">
        <h4 class="notification-title" id="notificationTitle">
          Notification
        </h4>
        <p class="notification-message" id="notificationMessage">
          This is a notification message.
        </p>
        <div class="notification-link-container" id="notificationLinkContainer" style="display: none">
          <a href="#" class="notification-link" id="notificationLink"><span id="notificationLinkText">View
              details</span><i class="fas fa-arrow-right"></i></a>
        </div>
      </div>
      <button class="notification-close" onclick="closeNotification()">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
  <script>
    const API = window.location.origin;
    const tenantId = sessionStorage.getItem("tenant_id");
    if (!tenantId) window.location.href = "tenant-login.html";
    let intents = [];
    let datasources = [];
    let existingRules = [];
    let editId = null;
    let deleteId = null;
    let currentIntent = null;
    let currentPolicy = null;
    let duplicateRuleId = null;
    let isEditingPolicy = false;
    let searchFilter = null;
    function showNotification(
      type,
      title,
      message,
      actionLabel = null,
      actionUrl = null,
    ) {
      const titleEl = document.getElementById("notificationTitle");
      const messageEl = document.getElementById("notificationMessage");
      const linkContainer = document.getElementById(
        "notificationLinkContainer",
      );
      const link = document.getElementById("notificationLink");
      const linkTextEl = document.getElementById("notificationLinkText");
      const popup = document.getElementById("notificationPopup");
      const iconWrapper = document.querySelector(".notification-icon");
      const iconEl = iconWrapper.querySelector("i");
      titleEl.textContent = title;
      messageEl.textContent = message;
      if (actionLabel && actionUrl) {
        linkTextEl.textContent = actionLabel;
        link.href = actionUrl;
        linkContainer.style.display = "block";
      } else {
        linkContainer.style.display = "none";
      }
      iconWrapper.style.background =
        "linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%)";
      iconEl.className = "fas fa-info-circle";
      if (type === "success") {
        iconWrapper.style.background =
          "linear-gradient(135deg, var(--success) 0%, #059669 100%)";
        iconEl.className = "fas fa-check-circle";
      } else if (type === "error") {
        iconWrapper.style.background =
          "linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%)";
        iconEl.className = "fas fa-times-circle";
      } else if (type === "warning") {
        iconWrapper.style.background =
          "linear-gradient(135deg, var(--warning) 0%, #d97706 100%)";
        iconEl.className = "fas fa-exclamation-triangle";
      } else {
        iconWrapper.style.background =
          "linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%)";
        iconEl.className = "fas fa-info-circle";
      }
      popup.classList.add("active");
      if (!actionLabel && !actionUrl) {
        setTimeout(closeNotification, 6000);
      }
    }
    function closeNotification() {
      document.getElementById("notificationPopup").classList.remove("active");
    }
    function toggleIntentActive() {
      const toggle = document.getElementById("intentIsActive");
      const label = document.getElementById("intentActiveLabel");
      toggle.classList.toggle("active");
      label.textContent = toggle.classList.contains("active")
        ? "Active"
        : "Inactive";
    }
    function toggleExpandRow(intentId, event) {
      if (
        event &&
        (event.target.closest(".action-btn") ||
          event.target.closest(".actions"))
      ) {
        return;
      }
      const expandedRow = document.getElementById(`expanded-${intentId}`);
      if (expandedRow) {
        expandedRow.classList.toggle("show");
      }
    }
    function formatFieldValue(value) {
      if (value === null || value === undefined || value === "") {
        return '<span class="null-value">Not set</span>';
      }
      if (typeof value === "boolean") {
        return value ? "Yes" : "No";
      }
      return escapeHtml(String(value));
    }
    function selectSearchIntent(intentId) {
      searchFilter = intentId;
      const searchInput = document.getElementById("intentSearch");
      const searchDropdown = document.getElementById("searchDropdown");
      if (intentId === null) {
        searchInput.value = "All Intents";
      } else {
        const intent = intents.find((i) => i.intent_id === intentId);
        if (intent) {
          searchInput.value = intent.display_name;
        }
      }
      searchDropdown.classList.remove("show");
      renderIntents();
    }
    function renderIntents() {
      let displayIntents = intents;

      if (searchFilter !== null && searchFilter !== undefined) {
        displayIntents = intents.filter(i => i.intent_id === searchFilter);
      }

      updateStatsBadge(displayIntents.length);

      if (!displayIntents.length) {
        document.getElementById("emptyState").style.display = "block";
        document.getElementById("intentTable").style.display = "none";
        return;
      }

      document.getElementById("emptyState").style.display = "none";
      document.getElementById("intentTable").style.display = "table";

      const tbody = document.getElementById("intentRows");
      tbody.innerHTML = "";

      displayIntents.forEach(r => {
        const statusClass = r.is_active ? "status-active" : "status-inactive";
        const statusIcon = r.is_active
          ? '<i class="fas fa-check-circle"></i>'
          : '<i class="fas fa-times-circle"></i>';
        const statusText = r.is_active ? "Active" : "Inactive";

        tbody.innerHTML += `
      <!-- COLLAPSED ROW (5 COLUMNS) -->
      <tr class="data-row" onclick="toggleExpandRow(${r.intent_id}, event)">
        <td style="text-align:center;">
          <div class="intent-name">
            <i class="fas fa-bullseye" style="color: var(--secondary); font-size: 0.9rem;"></i>
            ${escapeHtml(r.intent_code)}
          </div>
        </td>

        <td style="text-align:center;">
          <span class="display-name">${escapeHtml(r.display_name)}</span>
        </td>

        <td style="text-align:center; color: var(--text-secondary);">
          ${escapeHtml(r.description || "—")}
        </td>

        <td style="text-align:center;">
          <span class="status-badge ${statusClass}">
            ${statusIcon} ${statusText}
          </span>
        </td>

        <td style="text-align:center;">
          <div class="actions">
            <button class="action-btn" onclick="showDetails(${r.intent_id})" title="Details">
              <i class="fas fa-info-circle"></i> Details
            </button>
            <button class="action-btn" onclick="openEditModal(${r.intent_id})" title="Edit">
              <i class="fas fa-pen"></i> Edit
            </button>
            <button class="action-btn delete" onclick="openDeleteModal(${r.intent_id})" title="Delete">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </td>
      </tr>

      <!-- EXPANDED ROW (CLEANED) -->
      <tr class="expanded-row" id="expanded-${r.intent_id}">
        <td colspan="5">
          <div class="expanded-content">
            <div class="expanded-grid">

              <div class="expanded-field">
                <div class="expanded-field-label">Intent ID</div>
                <div class="expanded-field-value">${formatFieldValue(r.intent_id)}</div>
              </div>

              <div class="expanded-field">
                <div class="expanded-field-label">Intent Code</div>
                <div class="expanded-field-value">${formatFieldValue(r.intent_code)}</div>
              </div>

              <div class="expanded-field">
                <div class="expanded-field-label">Display Name</div>
                <div class="expanded-field-value">${formatFieldValue(r.display_name)}</div>
              </div>

              <div class="expanded-field">
                <div class="expanded-field-label">Description</div>
                <div class="expanded-field-value">${formatFieldValue(r.description)}</div>
              </div>

              <div class="expanded-field">
                <div class="expanded-field-label">Category</div>
                <div class="expanded-field-value">${formatFieldValue(r.category)}</div>
              </div>

              <div class="expanded-field">
                <div class="expanded-field-label">Is Active</div>
                <div class="expanded-field-value">${formatFieldValue(r.is_active)}</div>
              </div>

            </div>
          </div>
        </td>
      </tr>
    `;
      });
    }

    async function loadIntents() {
      try {
        document.getElementById("loadingState").style.display = "block";
        document.getElementById("intentTable").style.display = "none";
        document.getElementById("emptyState").style.display = "none";
        const [i, d, r] = await Promise.all([
          fetch(`${API}/intents`, {
            headers: { "X-Tenant-ID": tenantId },
          }).then((r) => r.json()),
          fetch(`${API}/datasources`, {
            headers: { "X-Tenant-ID": tenantId },
          }).then((r) => r.json()),
          fetch(`${API}/validation-rules`, {
            headers: { "X-Tenant-ID": tenantId },
          }).then((r) => r.json()),
        ]);
        intents = i;
        datasources = d;
        existingRules = r;
        document.getElementById("loadingState").style.display = "none";
        populateDatasourceDropdown();
        renderIntents();
      } catch (err) {
        console.error("Error loading intents:", err);
        document.getElementById("loadingState").innerHTML =
          '<i class="fas fa-exclamation-circle"></i><div class="loading-text">Failed to load intents</div>';
      }
    }
    function populateDatasourceDropdown() {
      const select = document.getElementById("ruleDatasource");
      const activeDatasources = datasources.filter((d) => d.is_active);
      select.innerHTML = '<option value="">Select a datasource</option>';
      select.innerHTML += activeDatasources
        .map(
          (d) =>
            `<option value="${d.datasource_id}">${escapeHtml(d.name)} (${escapeHtml(d.datasource_type)})</option>`,
        )
        .join("");
    }
    function updateStatsBadge(count) {
      const badge = document.getElementById("statsBadge");
      badge.textContent = `${count} ${count === 1 ? "intent" : "intents"}`;
    }
    function escapeHtml(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }
    function showError(message) {
      const errorEl = document.getElementById("errorMessage");
      errorEl.textContent = message;
      errorEl.style.display = "block";
    }
    function hideError() {
      const errorEl = document.getElementById("errorMessage");
      errorEl.style.display = "none";
    }
    async function showDetails(id) {
      currentIntent = intents.find((i) => i.intent_id === id);
      if (!currentIntent) {
        showNotification(
          "error",
          "Intent Not Found",
          "The requested intent could not be found. Please refresh the page and try again.",
        );
        return;
      }
      document.getElementById("detailIntentCode").textContent =
        currentIntent.intent_code;
      document.getElementById("detailDisplayName").textContent =
        currentIntent.display_name;
      document.getElementById("detailStatus").textContent =
        currentIntent.is_active ? "Active" : "Inactive";
      if (currentIntent.description) {
        document.getElementById("detailDescription").textContent =
          currentIntent.description;
        document.getElementById("detailDescContainer").style.display =
          "block";
      } else {
        document.getElementById("detailDescContainer").style.display = "none";
      }
      if (currentIntent.category) {
        document.getElementById("detailCategory").textContent =
          currentIntent.category;
        document.getElementById("detailCategoryContainer").style.display =
          "block";
      } else {
        document.getElementById("detailCategoryContainer").style.display =
          "none";
      }
      try {
        const res = await fetch(
          `${API}/intents/${currentIntent.intent_id}/policies/multi`,
          { headers: { "X-Tenant-ID": tenantId } },
        );
        const policyBtnText = document.getElementById("policyBtnText");
        if (res.ok) {
          currentPolicy = await res.json();
          policyBtnText.textContent = "Edit Intent Policy";
          isEditingPolicy = true;
        } else {
          currentPolicy = null;
          policyBtnText.textContent = "Add Intent Policy";
          isEditingPolicy = false;
        }
      } catch (err) {
        console.error("Error checking policy:", err);
        currentPolicy = null;
        isEditingPolicy = false;
      }
      document.getElementById("detailsModal").classList.add("active");
    }
    function closeDetailsModal() {
      document.getElementById("detailsModal").classList.remove("active");
    }
    async function handlePolicyAction() {
      if (!currentIntent) return;
      if (isEditingPolicy && currentPolicy) {
        await openEditPolicyModal();
      } else {
        await openAddPolicyModal();
      }
    }
    async function openAddPolicyModal() {
      if (!currentIntent) return;
      document.getElementById("policyModalTitle").textContent = "Add Policy";
      document.getElementById("savePolicyBtnText").textContent =
        "Save Policy";
      document.getElementById("policyIntentName").value =
        currentIntent.display_name;
      document.getElementById("language_code").value = "multi";
      document.getElementById("n8n_orchestration_url").value = "";
      document.getElementById("language_code").disabled = false;
      document.getElementById("auto_process_min_conf").value = "";
      document.getElementById("manual_review_min_conf").value = "";
      document.getElementById("reroute_email").value = "";
      document.getElementById("multi_intent_mode").value = "STRICT_SINGLE";
      document.getElementById("allow_multi_auto").checked = false;
      document.getElementById("allow_subset_auto").checked = false;
      document.getElementById("detailsModal").classList.remove("active");
      document.getElementById("policyModal").classList.add("active");
    }
    async function openEditPolicyModal() {
      if (!currentIntent || !currentPolicy) return;
      document.getElementById("policyModalTitle").textContent = "Edit Policy";
      document.getElementById("savePolicyBtnText").textContent =
        "Update Policy";
      document.getElementById("policyIntentName").value =
        currentIntent.display_name;
      document.getElementById("language_code").value =
        currentPolicy.language_code;
      document.getElementById("n8n_orchestration_url").value =
        currentPolicy.n8n_orchestration_url || "";
      document.getElementById("language_code").disabled = true;
      document.getElementById("auto_process_min_conf").value =
        currentPolicy.auto_process_min_conf;
      document.getElementById("manual_review_min_conf").value =
        currentPolicy.manual_review_min_conf;
      document.getElementById("reroute_email").value =
        currentPolicy.reroute_email || "";
      document.getElementById("multi_intent_mode").value =
        currentPolicy.multi_intent_mode;
      document.getElementById("allow_multi_auto").checked =
        currentPolicy.allow_multi_auto;
      document.getElementById("allow_subset_auto").checked =
        currentPolicy.allow_subset_auto;
      document.getElementById("detailsModal").classList.remove("active");
      document.getElementById("policyModal").classList.add("active");
    }
    function closePolicyModal() {
      document.getElementById("policyModal").classList.remove("active");
      document.getElementById("language_code").disabled = false;
    }
    async function savePolicy() {
      if (!currentIntent) return;
      const autoProcessConf = document.getElementById(
        "auto_process_min_conf",
      ).value;
      const manualReviewConf = document.getElementById(
        "manual_review_min_conf",
      ).value;
      if (!autoProcessConf || autoProcessConf === "") {
        showNotification(
          "warning",
          "Auto Process Confidence Required",
          "Please enter the auto process minimum confidence percentage.",
        );
        document.getElementById("auto_process_min_conf").focus();
        return;
      }
      if (!manualReviewConf || manualReviewConf === "") {
        showNotification(
          "warning",
          "Manual Review Confidence Required",
          "Please enter the manual review minimum confidence percentage.",
        );
        document.getElementById("manual_review_min_conf").focus();
        return;
      }
      const payload = {
        language_code: document.getElementById("language_code").value,
        n8n_orchestration_url:
          document.getElementById("n8n_orchestration_url").value.trim() ||
          null,
        auto_process_min_conf: parseFloat(autoProcessConf),
        manual_review_min_conf: parseFloat(manualReviewConf),
        reroute_email:
          document.getElementById("reroute_email").value.trim() || null,
        multi_intent_mode: document.getElementById("multi_intent_mode").value,
        allow_multi_auto: document.getElementById("allow_multi_auto").checked,
        allow_subset_auto:
          document.getElementById("allow_subset_auto").checked,
      };
      try {
        const url =
          isEditingPolicy && currentPolicy
            ? `${API}/intents/${currentIntent.intent_id}/policies/${currentPolicy.language_code}`
            : `${API}/intents/${currentIntent.intent_id}/policies`;
        const method = isEditingPolicy && currentPolicy ? "PUT" : "POST";
        const res = await fetch(url, {
          method,
          headers: {
            "Content-Type": "application/json",
            "X-Tenant-ID": tenantId,
          },
          body: JSON.stringify(payload),
        });
        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.detail || "Failed to save policy");
        }
        closePolicyModal();
        showNotification(
          "success",
          "Policy Saved Successfully",
          `The intent policy has been ${isEditingPolicy ? "updated" : "created"} successfully.`,
        );
        loadIntents();
      } catch (err) {
        console.error("Failed to save policy:", err);
        showNotification(
          "error",
          "Failed to Save Policy",
          err.message ||
          "An error occurred while saving the policy. Please try again.",
        );
      }
    }
    function openAddRuleModal() {
      if (!currentIntent) return;
      document.getElementById("ruleModalTitle").textContent =
        "Add Validation Rule";
      document.getElementById("saveRuleBtnText").textContent = "Save Rule";
      document.getElementById("editRuleId").value = "";
      document.getElementById("ruleIntentName").value =
        currentIntent.display_name;
      document.getElementById("ruleCode").value = "";
      document.getElementById("ruleName").value = "";
      document.getElementById("ruleDescription").value = "";
      document.getElementById("ruleDatasource").value = "";
      document.getElementById("ruleLanguage").value = "multi";
      document.getElementById("ruleOrder").value = "1";
      document.getElementById("ruleSeverity").value = "CRITICAL";
      updateNextOrder(currentIntent.intent_id);
      document.getElementById("detailsModal").classList.remove("active");
      document.getElementById("ruleModal").classList.add("active");
    }
    async function openEditRuleModal(ruleId) {
      if (!currentIntent) return;
      try {
        const rule = existingRules.find((r) => r.rule_id === ruleId);
        if (!rule) throw new Error("Rule not found");
        document.getElementById("ruleModalTitle").textContent =
          "Edit Validation Rule";
        document.getElementById("saveRuleBtnText").textContent =
          "Update Rule";
        document.getElementById("editRuleId").value = ruleId;
        document.getElementById("ruleIntentName").value =
          currentIntent.display_name;
        document.getElementById("ruleCode").value = rule.rule_code;
        document.getElementById("ruleName").value = rule.rule_name;
        document.getElementById("ruleDescription").value =
          rule.rule_description;
        document.getElementById("ruleDatasource").value = rule.datasource_id;
        document.getElementById("ruleLanguage").value = rule.language_code;
        document.getElementById("ruleOrder").value = rule.execution_order;
        document.getElementById("ruleSeverity").value = rule.severity;
        document.getElementById("detailsModal").classList.remove("active");
        document.getElementById("ruleModal").classList.add("active");
      } catch (err) {
        console.error("Failed to open edit rule modal:", err);
        showNotification(
          "error",
          "Failed to Load Rule",
          "An error occurred while loading the rule details. Please try again.",
        );
      }
    }
    function closeRuleModal() {
      document.getElementById("ruleModal").classList.remove("active");
    }
    async function updateNextOrder(intentId) {
      if (!intentId) return;
      try {
        const languageCode = document.getElementById("ruleLanguage").value;
        const response = await fetch(
          `${API}/validation-rules/next-order/${intentId}?language_code=${languageCode}`,
          { headers: { "X-Tenant-ID": tenantId } },
        );
        const data = await response.json();
        document.getElementById("ruleOrder").value =
          data.next_execution_order;
      } catch (error) {
        console.error("Error fetching next order:", error);
      }
    }
    async function saveRule() {
      if (!currentIntent) return;
      const editRuleId = document.getElementById("editRuleId").value;
      const ruleName = document.getElementById("ruleName").value.trim();
      const ruleCode = document.getElementById("ruleCode").value.trim();
      const ruleDescription = document
        .getElementById("ruleDescription")
        .value.trim();
      const datasourceId = document.getElementById("ruleDatasource").value;
      if (!ruleName) {
        showNotification(
          "warning",
          "Rule Name Required",
          "Please enter a rule name before saving.",
        );
        return;
      }
      if (!ruleCode) {
        showNotification(
          "warning",
          "Rule Code Required",
          "Please enter a rule code before saving.",
        );
        return;
      }
      if (!ruleDescription) {
        showNotification(
          "warning",
          "Rule Description Required",
          "Please enter a rule description before saving.",
        );
        return;
      }
      if (!datasourceId) {
        showNotification(
          "warning",
          "Datasource Required",
          "Please select a datasource before saving.",
        );
        return;
      }
      if (!editRuleId) {
        const rulesForThisIntent = existingRules.filter(
          (r) => r.intent_id === currentIntent.intent_id,
        );
        const duplicateName = rulesForThisIntent.find(
          (r) => r.rule_name.toLowerCase() === ruleName.toLowerCase(),
        );
        const duplicateCode = rulesForThisIntent.find(
          (r) => r.rule_code.toLowerCase() === ruleCode.toLowerCase(),
        );
        const duplicate = duplicateName || duplicateCode;
        if (duplicate) {
          duplicateRuleId = duplicate.rule_id;
          const duplicateField = duplicateName
            ? `name "${ruleName}"`
            : `code "${ruleCode}"`;
          document.getElementById("duplicateRuleName").textContent =
            duplicateField;
          document.getElementById("duplicateIntentName").textContent =
            currentIntent.display_name;
          document
            .getElementById("duplicateRuleModal")
            .classList.add("active");
          return;
        }
      }
      const payload = {
        intent_id: currentIntent.intent_id,
        language_code: document.getElementById("ruleLanguage").value,
        rule_code: ruleCode,
        rule_name: ruleName,
        rule_description: ruleDescription,
        datasource_id: parseInt(datasourceId),
        execution_order: parseInt(document.getElementById("ruleOrder").value),
        severity: document.getElementById("ruleSeverity").value,
        is_active: true,
      };
      try {
        const url = editRuleId
          ? `${API}/validation-rules/${editRuleId}`
          : `${API}/validation-rules`;
        const method = editRuleId ? "PUT" : "POST";
        const res = await fetch(url, {
          method,
          headers: {
            "Content-Type": "application/json",
            "X-Tenant-ID": tenantId,
          },
          body: JSON.stringify(payload),
        });
        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.detail || "Failed to save rule");
        }
        closeRuleModal();
        showNotification(
          "success",
          "Validation Rule Saved Successfully",
          `The validation rule has been ${editRuleId ? "updated" : "created"} successfully.`,
        );
        loadIntents();
      } catch (err) {
        console.error("Failed to save rule:", err);
        showNotification(
          "error",
          "Failed to Save Rule",
          err.message ||
          "An error occurred while saving the rule. Please try again.",
        );
      }
    }
    function closeDuplicateRuleModal() {
      document
        .getElementById("duplicateRuleModal")
        .classList.remove("active");
      duplicateRuleId = null;
    }
    async function editDuplicateRule() {
      const ruleIdToEdit = duplicateRuleId;
      closeDuplicateRuleModal();
      if (ruleIdToEdit) {
        try {
          const rule = existingRules.find((r) => r.rule_id === ruleIdToEdit);
          if (!rule) throw new Error("Rule not found");
          const ruleIntent = intents.find(
            (i) => i.intent_id === rule.intent_id,
          );
          if (!ruleIntent) throw new Error("Intent not found for this rule");
          currentIntent = ruleIntent;
          document.getElementById("ruleModalTitle").textContent =
            "Edit Validation Rule";
          document.getElementById("saveRuleBtnText").textContent =
            "Update Rule";
          document.getElementById("editRuleId").value = ruleIdToEdit;
          document.getElementById("ruleIntentName").value =
            ruleIntent.display_name;
        } catch (err) {
          console.error("Failed to convert to edit mode:", err);
          showNotification(
            "error",
            "Failed to Edit Rule",
            "An error occurred while loading the rule for editing. Please try again.",
          );
        }
      }
    }
    function openAddModal() {
      editId = null;
      document.getElementById("modalTitleText").innerText = "Add Intent";
      document.getElementById("intentId").value = "";
      document.getElementById("intent_code").value = "";
      document.getElementById("display_name").value = "";
      document.getElementById("description").value = "";
      document.getElementById("category").value = "";
      const toggle = document.getElementById("intentIsActive");
      const label = document.getElementById("intentActiveLabel");
      toggle.classList.add("active");
      label.textContent = "Active";
      hideError();
      document.getElementById("intentModal").classList.add("active");
    }
    async function openEditModal(id) {
      try {
        editId = id;
        document.getElementById("modalTitleText").innerText = "Edit Intent";
        document.getElementById("intentId").value = id;
        const intent = intents.find((i) => i.intent_id === id);
        if (!intent) throw new Error("Intent not found");
        document.getElementById("intent_code").value = intent.intent_code;
        document.getElementById("display_name").value = intent.display_name;
        document.getElementById("description").value =
          intent.description || "";
        document.getElementById("category").value = intent.category || "";
        const toggle = document.getElementById("intentIsActive");
        const label = document.getElementById("intentActiveLabel");
        if (intent.is_active) {
          toggle.classList.add("active");
          label.textContent = "Active";
        } else {
          toggle.classList.remove("active");
          label.textContent = "Inactive";
        }
        hideError();
        document.getElementById("intentModal").classList.add("active");
      } catch (err) {
        console.error("Error loading intent:", err);
        showNotification(
          "error",
          "Failed to Load Intent",
          "An error occurred while loading the intent details. Please try again.",
        );
      }
    }
    function closeIntentModal() {
      document.getElementById("intentModal").classList.remove("active");
      hideError();
    }
    async function saveIntent() {
      try {
        hideError();
        const id = document.getElementById("intentId").value;
        const intent_code = document
          .getElementById("intent_code")
          .value.trim();
        const display_name = document
          .getElementById("display_name")
          .value.trim();
        const description = document
          .getElementById("description")
          .value.trim();
        const category = document.getElementById("category").value.trim();
        const toggle = document.getElementById("intentIsActive");
        const is_active = toggle.classList.contains("active");
        if (!intent_code || !display_name) {
          showNotification(
            "warning",
            "Required Fields Missing",
            "Intent Code and Display Name are required fields. Please fill them in to continue.",
          );
          return;
        }
        const payload = {
          intent_code,
          display_name,
          description: description || null,
          category: category || null,
          is_active,
          policies: [],
        };
        const url = id ? `${API}/intents/${id}` : `${API}/intents`;
        const method = id ? "PUT" : "POST";
        if (id) {
          delete payload.policies;
        }
        const res = await fetch(url, {
          method,
          headers: {
            "Content-Type": "application/json",
            "X-Tenant-ID": tenantId,
          },
          body: JSON.stringify(payload),
        });
        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.detail || "Failed to save intent");
        }
        closeIntentModal();
        showNotification(
          "success",
          "Intent Saved Successfully",
          `The intent has been ${id ? "updated" : "created"} successfully.`,
        );
        loadIntents();
      } catch (err) {
        console.error("Error saving intent:", err);
        showNotification(
          "error",
          "Failed to Save Intent",
          err.message ||
          "An error occurred while saving the intent. Please try again.",
        );
      }
    }
    function openDeleteModal(id) {
      deleteId = id;
      document.getElementById("deleteIntentId").value = id;
      document.getElementById("deleteModal").classList.add("active");
    }
    function closeDeleteModal() {
      deleteId = null;
      document.getElementById("deleteModal").classList.remove("active");
    }
    async function confirmDelete() {
      const id = document.getElementById("deleteIntentId").value;
      if (!id) return;
      try {
        const res = await fetch(`${API}/intents/${id}`, {
          method: "DELETE",
          headers: { "X-Tenant-ID": tenantId },
        });
        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.detail || "Failed to delete intent");
        }
        closeDeleteModal();
        showNotification(
          "success",
          "Intent Deleted",
          "The intent and all associated policies and rules have been deleted successfully.",
        );
        loadIntents();
      } catch (err) {
        console.error("Error deleting intent:", err);
        showNotification(
          "error",
          "Failed to Delete Intent",
          err.message ||
          "An error occurred while deleting the intent. Please try again.",
        );
        closeDeleteModal();
      }
    }
    document.getElementById("intentModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeIntentModal();
    });
    document.getElementById("detailsModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeDetailsModal();
    });
    document.getElementById("policyModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closePolicyModal();
    });
    document.getElementById("ruleModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeRuleModal();
    });
    document.getElementById("deleteModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeDeleteModal();
    });
    document
      .getElementById("duplicateRuleModal")
      .addEventListener("click", (e) => {
        if (e.target === e.currentTarget) closeDuplicateRuleModal();
      });
    document
      .getElementById("ruleLanguage")
      .addEventListener("change", function () {
        if (currentIntent) {
          updateNextOrder(currentIntent.intent_id);
        }
      });
    loadIntents();
  </script>
  <script src="responsive.js"></script>
</body>

</html>